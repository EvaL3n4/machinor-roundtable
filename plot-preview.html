<div id="mr_plot_sidebar" class="mr-plot-sidebar collapsed" role="complementary" aria-hidden="true">
    <div class="mr-sidebar-header">
        <h3>Plot Preview</h3>
        <button id="mr_toggle_sidebar" class="mr-toggle-btn" title="Toggle Plot Preview" aria-controls="mr_plot_sidebar" aria-expanded="false" aria-label="Toggle Plot Preview sidebar">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
    
    <div class="mr-sidebar-content">
        <!-- Current Plot Section -->
        <div class="mr-current-plot">
            <div class="mr-plot-header">
                            <span class="mr-status-indicator ready" id="mr_status_indicator"></span>
                            <span class="mr-status-text" id="mr_status_text">Ready</span>
                            <span class="mr-timer" id="mr_approval_timer"></span>
                        </div>
            
                        <!-- Narrative Arc Progress -->
                        <div class="mr-arc-progress" id="mr_arc_progress">
                            <div class="mr-arc-header">
                                <h4>Story Arc</h4>
                                <span class="mr-arc-type" id="mr_arc_type">Natural Progression</span>
                            </div>
                            <div class="mr-arc-bar">
                                <div class="mr-arc-fill" id="mr_arc_fill" style="width: 0%"></div>
                            </div>
                            <div class="mr-arc-details">
                                <span class="mr-arc-phase" id="mr_arc_phase">Not started</span>
                                <span class="mr-arc-percentage" id="mr_arc_percentage">0%</span>
                            </div>
                        </div>
            
                        <!-- Story Intelligence Panel -->
                        <div class="mr-story-intel" id="mr_story_intel">
                            <div class="mr-intel-header">
                                <h4>Story Intelligence</h4>
                                <span class="mr-intel-toggle" id="mr_intel_toggle">
                                    <i class="fa-solid fa-chevron-down"></i>
                                </span>
                            </div>
                            <div class="mr-intel-content collapsed" id="mr_intel_content">
                                <div class="mr-intel-item">
                                    <label>Character Analysis:</label>
                                    <div class="mr-intel-value" id="mr_character_analysis">Not analyzed</div>
                                </div>
                                <div class="mr-intel-item">
                                    <label>World Context:</label>
                                    <div class="mr-intel-value" id="mr_world_context">No world data</div>
                                </div>
                                <div class="mr-intel-item">
                                    <label>Multi-Character:</label>
                                    <div class="mr-intel-value" id="mr_character_count">Single character</div>
                                </div>
                            </div>
                        </div>
            
                        <!-- Plot Template Gallery -->
                        <div class="mr-template-gallery" id="mr_template_gallery">
                            <div class="mr-template-header">
                                <h4>Plot Templates</h4>
                                <span class="mr-template-toggle" id="mr_template_toggle">
                                    <i class="fa-solid fa-chevron-down"></i>
                                </span>
                            </div>
                            <div class="mr-template-content collapsed" id="mr_template_content">
                                <div class="mr-template-categories">
                                    <div class="mr-category-tabs" id="mr_category_tabs">
                                        <button class="mr-tab-btn active" data-category="romance">Romance</button>
                                        <button class="mr-tab-btn" data-category="adventure">Adventure</button>
                                        <button class="mr-tab-btn" data-category="mystery">Mystery</button>
                                        <button class="mr-tab-btn" data-category="friendship">Friendship</button>
                                        <button class="mr-tab-btn" data-category="hero">Hero's Journey</button>
                                    </div>
                                    <div class="mr-templates-list" id="mr_templates_list">
                                        <div class="mr-template-item" data-template="meet_cute">
                                            <div class="mr-template-icon">üíï</div>
                                            <div class="mr-template-info">
                                                <div class="mr-template-name">Meet Cute</div>
                                                <div class="mr-template-desc">Two characters meet in an unexpected way</div>
                                            </div>
                                            <button class="mr-template-select" data-template="meet_cute">Select</button>
                                        </div>
                                        <div class="mr-template-item" data-template="adventure_begins">
                                            <div class="mr-template-icon">üó∫Ô∏è</div>
                                            <div class="mr-template-info">
                                                <div class="mr-template-name">Adventure Begins</div>
                                                <div class="mr-template-desc">A call to action starts the quest</div>
                                            </div>
                                            <button class="mr-template-select" data-template="adventure_begins">Select</button>
                                        </div>
                                        <div class="mr-template-item" data-template="mystery_hook">
                                            <div class="mr-template-icon">üîç</div>
                                            <div class="mr-template-info">
                                                <div class="mr-template-name">Mystery Hook</div>
                                                <div class="mr-template-desc">A strange event that needs investigation</div>
                                            </div>
                                            <button class="mr-template-select" data-template="mystery_hook">Select</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            
            <div class="mr-plot-text" id="mr_current_plot_text">
                No active plot. Click generate to create one.
            </div>
            
            <div class="mr-plot-actions">
                <button id="mr_edit_plot" class="mr-action-btn" title="Edit Plot">
                    <i class="fa-solid fa-pen"></i> Edit
                </button>
                <button id="mr_skip_plot" class="mr-action-btn" title="Skip Plot">
                    <i class="fa-solid fa-forward"></i> Skip
                </button>
                <button id="mr_pause_plot" class="mr-action-btn" title="Pause Auto-Inject">
                    <i class="fa-solid fa-pause"></i> Pause
                </button>
            </div>
            
            <div class="mr-direction-input">
                <label for="mr_plot_direction">Direction:</label>
                <input type="text" id="mr_plot_direction" 
                       placeholder="Make it more romantic, add conflict..."
                       autocomplete="off">
                <div class="mr-recent-directions" id="mr_recent_directions"></div>
            </div>
        </div>

        <!-- Next Plot Preview -->
        <div class="mr-next-plot">
            <h4>Next Plot Preview</h4>
            <div class="mr-plot-text" id="mr_next_plot_text">
                Generating next plot suggestion...
            </div>
            <button id="mr_regenerate_next" class="mr-action-btn small">
                <i class="fa-solid fa-arrows-rotate"></i> Regenerate
            </button>
        </div>

        <!-- Plot History -->
        <div class="mr-plot-history">
            <div class="mr-history-header" id="mr_history_toggle">
                <h4>Plot History</h4>
                <i class="fa-solid fa-chevron-down"></i>
            </div>
            <div class="mr-history-content collapsed" id="mr_history_content">
                <div id="mr_history_list"></div>
                <div class="mr-history-settings">
                    <label>Track: 
                        <input type="number" id="mr_history_limit" 
                               min="1" max="20" value="5" size="3">
                        plots
                    </label>
                </div>
            </div>
        </div>

        <!-- Manual Plot Entry -->
        <div class="mr-manual-entry">
            <button id="mr_manual_plot_btn" class="mr-action-btn full-width">
                <i class="fa-solid fa-keyboard"></i> Write Custom Plot
            </button>
        </div>
    </div>
</div>

<!-- Mobile Floating Toggle Button -->
<button id="mr_mobile_toggle" class="mr-mobile-toggle" title="Toggle Plot Preview" aria-controls="mr_plot_sidebar" aria-expanded="false" aria-label="Toggle Plot Preview sidebar">
    <i class="fa-solid fa-book-open"></i>
</button>

<!-- Plot Editor Modal -->
<div id="mr_plot_editor_modal" class="mr-modal">
    <div class="mr-modal-content">
        <div class="mr-modal-header">
            <h3>Edit Plot</h3>
            <button id="mr_close_modal" class="mr-close-btn">&times;</button>
        </div>
        <div class="mr-modal-body">
            <textarea id="mr_plot_editor_text" 
                      placeholder="Enter your plot context here..."
                      rows="8"></textarea>
        </div>
        <div class="mr-modal-footer">
            <button id="mr_save_plot" class="mr-btn-primary">Save</button>
            <button id="mr_cancel_edit" class="mr-btn-secondary">Cancel</button>
        </div>
    </div>
</div>